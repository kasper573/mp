# Fail2ban filter for general web application attacks via Caddy
# Monitors for common attack patterns in Caddy JSON access logs

[Definition]
# Match common web application attacks in JSON format
failregex = ^.*"remote_ip":"<HOST>".*"status":(4[0-9]{2}|5[0-9]{2}).*$
            ^.*"remote_ip":"<HOST>".*"request":.*"uri":"[^"]*(\.\./|\.\.\\|/etc/passwd|/proc/|admin|phpmyadmin|wp-admin|xmlrpc|\.php|\.asp|\.jsp|\.cgi|sql|select|union|script|alert|eval|base64)[^"]*".*$
            ^.*"remote_ip":"<HOST>".*"request":.*"(drop|delete|insert|update|create|alter|exec|script|onload|onerror|javascript|vbscript)".*$

# Ignore legitimate requests
ignoreregex = ^.*"remote_ip":"<HOST>".*"status":(200|201|301|302|304).*$